      - name: Processar Cronograma e Compilar
        run: |
          mkdir -p publish
          HOJE=$(date +%Y%m%d)
          
          # Caminho do arquivo
          ARQUIVO="dados/cronograma.csv"

          # 1. Detecta o separador (Tenta vírgula, se falhar tenta ponto-e-vírgula)
          SEP=","
          if ! grep -q "," "$ARQUIVO"; then SEP=";"; fi
          echo "Separador detectado: '$SEP'"

          # 2. Lê o arquivo limpando espaços e caracteres de Windows (\r)
          tail -n +2 "$ARQUIVO" | tr -d '\r' | while IFS="$SEP" read -r numero assunto curta data_csv; do
            
            # Limpa espaços em branco das variáveis
            num=$(echo "$numero" | xargs)
            ass=$(echo "$assunto" | xargs)
            cur=$(echo "$curta" | xargs)
            dat=$(echo "$data_csv" | xargs)

            # Pula linhas vazias
            [ -z "$dat" ] && continue

            # Converte DD/MM/AAAA para AAAAMMDD
            # Usa awk para garantir que pegamos os campos certos independente de espaços
            DATA_ISO=$(echo "$dat" | awk -F'/' '{print $3$2$1}')

            echo "Item $num | Data: $DATA_ISO | Hoje: $HOJE"

            # Comparação numérica
            if [ "$DATA_ISO" -le "$HOJE" ]; then
              echo "✅ DISPARADO: Compilando $num..."
              
              PREAMBLE="\def\VARNumero{$num}\def\VARAssunto{$ass}"
              pdflatex -interaction=nonstopmode -jobname="resultado_${num}" "$PREAMBLE\input{main.tex}"
              
              if [ -f "resultado_${num}.pdf" ]; then
                cp "resultado_${num}.pdf" "publish/edital_${num}_${cur}.pdf"
              fi
            else
              echo "⏳ AGENDADO: $num para $dat"
            fi
          done
